<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="TodoApp.Views.Dashboard"
    HideSoftInputOnTapped="True"
    Shell.BackgroundColor="LightBlue"
    xmlns:controls="clr-namespace:TodoApp.Controls"
    xmlns:converter="clr-namespace:TodoApp.Converters">
    <Shell.BackButtonBehavior>
        <BackButtonBehavior IsVisible="False"/>
    </Shell.BackButtonBehavior>
    <Shell.TitleView>
    <Grid>
        <Grid 
            IsVisible="{OnIdiom Desktop=false,Phone=true}"
            ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="115" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Label
                Grid.Column="0" 
                Text="Aman Singh"
                TextColor="White" 
                FontFamily="Inter-Regular" 
                VerticalTextAlignment="Center" 
                FontSize="16"
                Margin="10,0,0,0" 
                VerticalOptions="Center"/>
            <ImageButton 
                Grid.Column="3" 
                Source="add.png" 
                WidthRequest="29" 
                HeightRequest="29" 
                Command="{Binding TaskAddedCommand}" />

            <ImageButton 
                Grid.Column="4" 
                Source="pin.png" 
                WidthRequest="25" 
                HeightRequest="25" 
                Command="{Binding SetSelectedItemStatusCommand}" />

            <ImageButton 
                Grid.Column="5" 
                Source="dustbin.png" 
                WidthRequest="23" 
                HeightRequest="25" 
                Command="{Binding DeleteSelectedItemsCommand}" />

            <ImageButton 
                Grid.Column="6" 
                Source="menu.png" 
                WidthRequest="23" 
                Command="{Binding OpenMenuCommand}" />
        </Grid>
            <Grid 
                ColumnSpacing="10"
                IsVisible="{OnIdiom Desktop=True,Phone=false}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Icons -->
                <ImageButton 
                    Grid.Column="2"
                    Source="add.png"
                    WidthRequest="4"
                    HeightRequest="1"
                    Command="{Binding TaskAddedCommand}"
                    BackgroundColor="Transparent" />

                <ImageButton 
                    Grid.Column="3"            
                    Source="pin.png"
                    WidthRequest="4"
                    Command="{Binding SetSelectedItemStatusCommand}"
                    BackgroundColor="Transparent" />

                <ImageButton 
                    Grid.Column="4"
                    Source="dustbin.png"                  
                    WidthRequest="4"
                    HeightRequest="1"
                    Command="{Binding DeleteSelectedItemsCommand}"
                    BackgroundColor="Transparent" />

                <ImageButton 
                    Grid.Column="5"                  
                    Source="menu.png"
                    WidthRequest="4"
                    HeightRequest="1"
                    Command="{Binding OpenMenuCommand}"
                    BackgroundColor="Transparent" />
            </Grid>
        </Grid>
    </Shell.TitleView>
    <Grid>
        <Grid
            BackgroundColor="Transparent">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Frame
               Grid.Row="0" 
               HeightRequest="50" 
               BackgroundColor="{StaticResource Gray100}"
               Margin="10" 
               Padding="5" 
               CornerRadius="15" 
               BorderColor="Transparent">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="250"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <SearchBar 
                       Grid.Row="0" 
                       Grid.Column="0" 
                       Placeholder="Search" 
                       Text="{Binding SearchText, Mode=TwoWay}" 
                       SearchCommand="{Binding SearchCommand}" />
                    <ImageButton 
                        Grid.Row="0" 
                        Grid.Column="1" 
                        HorizontalOptions="End"
                        Source="sort.png" 
                        BackgroundColor="Transparent" 
                        Command="{Binding SortCommand}" />
                </Grid>
            </Frame>

            <Frame 
                Grid.Row="1" 
                BorderColor="Transparent"
                BackgroundColor="Transparent" 
                Margin="15,0,15,0" 
                Padding="10">
                <Grid 
                    RowSpacing="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="65" />
                    </Grid.RowDefinitions>
                    <Label 
                       Grid.Row="0" 
                       Text="Pinned Items" 
                       FontSize="20" 
                       FontFamily="Inter-Bold" 
                        FontAttributes="Bold"
                       HorizontalOptions="Center" />
                    <CollectionView 
                       Grid.Row="1" 
                       ItemsSource="{Binding Items}" 
                       HorizontalScrollBarVisibility="Never">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout 
                                Orientation="Horizontal" 
                                ItemSpacing="1" />
                        </CollectionView.ItemsLayout>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <StackLayout>
                                    <Border 
                                        Padding="{OnPlatform Android='12,7,10,10'}" 
                                        Margin="0,0,15,0">
                                        <VerticalStackLayout>
                                            <Label 
                                               Text="{Binding Name}" 
                                               FontSize="20" 
                                               FontFamily="Inter-Bold" 
                                               MaximumWidthRequest="100" 
                                               LineBreakMode="TailTruncation"/>
                                            <Label 
                                                Text="{Binding Priority}" 
                                                FontSize="14" 
                                                FontFamily="Inter-Regular" 
                                                Margin="5,0,0,0" />
                                        </VerticalStackLayout>
                                    </Border>
                                </StackLayout>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Grid>
            </Frame>

            <VerticalStackLayout 
                Grid.RowSpan="3" 
                HorizontalOptions="FillAndExpand"
                VerticalOptions="CenterAndExpand">
                <Image 
                    Source="checklist_icon.png" 
                    Aspect="AspectFit" 
                    WidthRequest="200"
                    HeightRequest="200" 
                    Margin="0,0,0,30"/>
                <Label 
                    Text="Nothing to show yet, Create an item by tapping on +" 
                    HorizontalTextAlignment="Center" 
                    FontFamily="Inter-Regular" 
                    FontSize="14"/>
            </VerticalStackLayout>

            <ListView 
                Grid.Row="2" 
                Margin="10" 
                ItemsSource="{Binding Items}" 
                RowHeight="115" 
                SeparatorVisibility="None" 
                VerticalScrollBarVisibility="Never"
                CachingStrategy="RecycleElement" 
                IsPullToRefreshEnabled="True">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ViewCell>
                            <Border 
                                Padding="5,0,0,0" 
                                Margin="5">
                                <Grid
                                    RowSpacing="0"
                                    ColumnSpacing="0" 
                                    Margin="-5">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="35" />
                                        <RowDefinition Height="30" />
                                        <RowDefinition Height="{OnPlatform Android=30}" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="50" />
                                        <ColumnDefinition Width="150" />
                                        <ColumnDefinition Width="{OnPlatform Android=70}" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <HorizontalStackLayout 
                                        Grid.Row="0" 
                                        Grid.Column="1" 
                                        Grid.ColumnSpan="2"
                                        Spacing="5">
                                        <Label 
                                            Grid.Row="0" 
                                            Grid.Column="1" 
                                            Grid.ColumnSpan="1" 
                                            Margin="15,10,0,0" 
                                            HorizontalOptions="StartAndExpand" 
                                            VerticalOptions="End"
                                            Text="{Binding Name}"
                                            LineBreakMode="TailTruncation" 
                                            FontSize="20" 
                                            FontFamily="Inter-Bold" 
                                            MaximumWidthRequest="180"/>

                                        <Frame 
                                            Grid.Row="0" 
                                            Grid.Column="2"
                                            WidthRequest="30"
                                            VerticalOptions="End" 
                                            HorizontalOptions="Start" 
                                            HeightRequest="25"
                                            Padding="0"
                                            BackgroundColor="{AppThemeBinding Dark={StaticResource CriticalPriorityColor}, Light={StaticResource DarkGH}}" IsVisible="{Binding HasAttachment}">
                                            <Image 
                                                Source="attachment.png" 
                                                Aspect="AspectFit"                                             
                                                HeightRequest="50"
                                                WidthRequest="15"/>
                                        </Frame>

                                        <Frame 
                                            Grid.Row="0" 
                                            Grid.Column="2"
                                            WidthRequest="30" 
                                            VerticalOptions="End" 
                                            HorizontalOptions="Start"
                                            HeightRequest="25" 
                                            Padding="0"
                                            BackgroundColor="{AppThemeBinding Dark={StaticResource CriticalPriorityColor}, Light={StaticResource DarkGH}}" IsVisible="{Binding IsPinned}">
                                            <Image 
                                                Source="pin.png" 
                                                Aspect="AspectFit" 
                                                HeightRequest="50" 
                                                WidthRequest="20"/>
                                        </Frame>

                                    </HorizontalStackLayout>

                                    <Grid 
                                        Grid.Row="1"
                                        Grid.Column="4" 
                                        Margin="0,0,15,0">
                                        <CheckBox 
                                            IsChecked="{Binding IsSelected}">
                                            <CheckBox.Scale>
                                                <OnPlatform 
                                                x:TypeArguments="x:Double">
                                                    <On Platform="iOS" Value="1.2" />
                                                    <On Platform="Android" Value="1.1" />
                                                </OnPlatform>
                                            </CheckBox.Scale>
                                        </CheckBox>
                                        <Grid.GestureRecognizers>
                                            <TapGestureRecognizer
                                                 Command="{Binding Source={RelativeSource AncestorType={x:Type ListView}}, Path=BindingContext.CheckBoxCheckedCommand}"
                                                 CommandParameter="{Binding .}" />
                                        </Grid.GestureRecognizers>
                                    </Grid>

                                    <Frame 
                                        BorderColor="Transparent" 
                                        Grid.Column="0" 
                                        HasShadow="False" 
                                        Grid.RowSpan="5" 
                                        Margin="{OnPlatform Android='-10,-10,0,-20'}" 
                                        WidthRequest="25" 
                                        HorizontalOptions="Start">
                                        <Frame.Triggers>
                                            <DataTrigger 
                                                TargetType="Frame"
                                                Binding="{Binding Priority}"
                                                Value="High">
                                                <Setter 
                                                    Property="BackgroundColor"
                                                    Value="{DynamicResource HighPriorityColor}" />
                                            </DataTrigger>
                                            <DataTrigger 
                                                TargetType="Frame" Binding="{Binding Priority}" Value="Medium">
                                                <Setter Property="BackgroundColor" Value="{DynamicResource MediumPriorityColor}" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Frame" Binding="{Binding Priority}" Value="Low">
                                                <Setter Property="BackgroundColor" Value="{DynamicResource LowPriorityColor}" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Frame" Binding="{Binding Priority}" Value="Critical">
                                                <Setter Property="BackgroundColor" Value="{DynamicResource CriticalPriorityColor}" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Frame" Binding="{Binding Priority}" Value="">
                                                <Setter Property="BackgroundColor" Value="Transparent" />
                                            </DataTrigger>
                                        </Frame.Triggers>
                                    </Frame>

                                    <Label
                                        Grid.ColumnSpan="5" 
                                        Grid.Row="1" 
                                        Grid.Column="1"
                                        HorizontalOptions="StartAndExpand" 
                                        LineBreakMode="TailTruncation"
                                        Margin="15,5,0,0" 
                                        VerticalOptions="Start" 
                                        FontSize="Body" 
                                        WidthRequest="250" 
                                        Text="{Binding Notes}" 
                                        FontFamily="Inter-Regular" />

                                    <Frame 
                                        Grid.Row="2" 
                                        Grid.Column="1" 
                                        WidthRequest="130" 
                                        Padding="6,0,0,0" 
                                        Margin="20,10,15,0" 
                                        HeightRequest="25"
                                        BackgroundColor="Transparent" 
                                        BorderColor="Gray">
                                        <HorizontalStackLayout>
                                            <Image 
                                                Source="calendar.png" 
                                                Aspect="AspectFit" 
                                                MaximumWidthRequest="15"
                                                Margin="0,0,4,0"/>
                                            <Label 
                                                HorizontalOptions="StartAndExpand" 
                                                VerticalOptions="Center" 
                                                WidthRequest="120" 
                                                TextColor="{AppThemeBinding Dark=DarkGray, Light=Black}" 
                                                FontFamily="Inter-Regular">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span 
                                                            Text="{Binding Date, StringFormat='{0:MMM dd, HH:mm}'}" />
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>
                                        </HorizontalStackLayout>
                                    </Frame>

                                    <Frame 
                                        Grid.Row="2" 
                                        Grid.Column="{OnPlatform Android=2}" 
                                        Grid.ColumnSpan="2" 
                                        HorizontalOptions="{OnPlatform Android=Start}" 
                                        HeightRequest="25" 
                                        Margin="0,10,0,0"
                                        Padding="{OnPlatform Android=3}"
                                        BorderColor="Gray"
                                        BackgroundColor="{AppThemeBinding Dark=Black, Light=White}">
                                        <Frame.Triggers>
                                            <DataTrigger 
                                                TargetType="Frame" 
                                                Binding="{Binding Done}" 
                                                Value="True">
                                                <Setter 
                                                    Property="WidthRequest"
                                                    Value="80" />
                                            </DataTrigger>
                                            <DataTrigger 
                                                TargetType="Frame" 
                                                Binding="{Binding Done}" 
                                                Value="False">
                                                <Setter 
                                                    Property="WidthRequest"
                                                    Value="100" />
                                            </DataTrigger>
                                        </Frame.Triggers>
                                        <HorizontalStackLayout>
                                            <Image 
                                                HeightRequest="20" 
                                                Aspect="AspectFit">
                                                <Image.Triggers>
                                                    <DataTrigger 
                                                        TargetType="Image"
                                                        Binding="{Binding Done}" 
                                                        Value="True">
                                                        <Setter 
                                                            Property="Source"
                                                            Value="done.png" />
                                                    </DataTrigger>
                                                    <DataTrigger 
                                                        TargetType="Image" 
                                                        Binding="{Binding Done}" 
                                                        Value="False">
                                                        <Setter 
                                                            Property="Source"
                                                            Value="notdone.png" />
                                                    </DataTrigger>
                                                </Image.Triggers>
                                            </Image>
                                            <Label 
                                                VerticalTextAlignment="Center" 
                                                FontAutoScalingEnabled="False"
                                                FontFamily="Inter-Bold" 
                                                TextColor="{AppThemeBinding Dark=White, Light=Black}"
                                                Margin="{OnPlatform Android='0,0,0,0'}">
                                                <Label.Triggers>
                                                    <DataTrigger TargetType="Label" Binding="{Binding Done}" Value="True">
                                                        <Setter Property="Text" Value="Done" />
                                                    </DataTrigger>
                                                    <DataTrigger TargetType="Label" Binding="{Binding Done}" Value="False">
                                                        <Setter Property="Text" Value="Not done" />
                                                    </DataTrigger>
                                                </Label.Triggers>
                                            </Label>
                                        </HorizontalStackLayout>
                                    </Frame>
                                </Grid>
                            </Border>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>
    </Grid>
</ContentPage>